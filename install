#!/usr/bin/env zsh

cd ~
home_dir=`pwd`
cd -
echo "Using $home_dir as home directory"

dotfiles_dir="$home_dir/dotfiles"

cd $dotfiles_dir

if [ -d $home_dir/.oh-my-zsh/themes ]; then
  rm -rf $home_dir/.oh-my-zsh/themes
  ln -s $dotfiles_dir/zsh/themes $home_dir/.oh-my-zsh/themes
fi

if [ ! -f $home_dir/.vimrc ] || [ ! -f $home_dir/.vimrc.local ] || [ ! -d $home_dir/.vim/colors ]; then
	echo "Linking vim"
	stow vim
fi

if [ ! -d $home_dir/.config/nvim ]; then
   ln -s $dotfiles_dir/nvim $home_dir/.config/nvim
fi

if [ ! -f $home_dir/.ideavimrc ]; then
	echo "Linking ideavim"
	stow ideavim
fi

if [ ! -f $home_dir/.tmux.conf ]; then
	echo "Linking tmux"
	stow tmux
fi

if [ ! -f $home_dir/.gitconfig ]; then
	echo "Copying gitconfig"
 	cp $dotfiles_dir/git/.gitconfig ~/
fi

if ! [ -x "$(command -v code)" ]
then
  echo 'Error: VSCode CLI is not installed.' >&2
else
  # Generated by code --list-extensions | xargs -L 1 echo code --install-extension
  code --install-extension eamodio.gitlens
  code --install-extension ehaynes99.vscode-select-same-text
  code --install-extension Equinusocio.vsc-community-material-theme
  code --install-extension Equinusocio.vsc-material-theme
  code --install-extension equinusocio.vsc-material-theme-icons
  code --install-extension sleistner.vscode-fileutils
  code --install-extension vscodevim.vim
fi

if [ ! -d $home_dir/.vscode/extensions/theme-themer-vscode ]; then
  echo "Linking VSCode config - theme (via extensions)"
  ln -s $dotfiles_dir/vscode/extensions/theme-themer-vscode $home_dir/.vscode/extensions/theme-themer-vscode
fi

if [ ! -f $home_dir/Library/Application\ Support/Code/User/settings.json ]; then
  echo "Linking VSCode config - settings.json"
  ln -s $dotfiles_dir/vscode/settings.json $home_dir/Library/Application\ Support/Code/User/settings.json
fi

if [ ! -f $home_dir/Library/Application\ Support/Code/User/keybindings.json ]; then
  echo "Linking VSCode config - keybindings.json"
  ln -s $dotfiles_dir/vscode/keybindings.json $home_dir/Library/Application\ Support/Code/User/keybindings.json
fi

if [ ! -d $home_dir/Library/Application\ Support/Code/User/snippets ]; then
  echo "Linking VSCode config - snippets"
  ln -s $dotfiles_dir/vscode/snippets $home_dir/Library/Application\ Support/Code/User/snippets
fi

cd ~
