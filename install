#!/usr/bin/env zsh

cd ~
home_dir=`pwd`
cd -
echo "Using $home_dir as home directory"

dotfiles_dir="$home_dir/dotfiles"

cd $dotfiles_dir

if [ ! -f $home_dir/.vimrc ] || [ ! -f $home_dir/.vimrc.local ] || [ ! -d $home_dir/.vim/colors ]; then
	echo "Linking vim"
	stow vim
fi

if [ ! -d $home_dir/powerlevel10k ]; then
  echo "Installing p10k"
  git clone --depth=1 https://github.com/romkatv/powerlevel10k.git $home_dir/powerlevel10k
  echo "source $home_dir/powerlevel10k/powerlevel10k.zsh-theme"
fi

if [ ! -f $home_dir/.zshrc ]; then
  echo "Linking zshrc"
  stow zsh
fi

if [ ! -d $home_dir/.config/nvim ]; then
   ln -s $dotfiles_dir/nvim $home_dir/.config/nvim
fi

if [ ! -f $home_dir/.ideavimrc ]; then
	echo "Linking ideavim"
	stow ideavim
fi

if [ ! -f $home_dir/.tmux.conf ]; then
	echo "Linking tmux"
	stow tmux
fi

if [ ! -f $home_dir/.gitconfig ]; then
	echo "Copying gitconfig"
 	cp $dotfiles_dir/git/.gitconfig ~/
fi

if ! [ -x "$(command -v code)" ]
then
  echo 'Error: VSCode CLI is not installed.' >&2
else
  # Generated by code --list-extensions | xargs -L 1 echo code --install-extension
  code --install-extension bungcip.better-toml
  code --install-extension dbaeumer.vscode-eslint
  code --install-extension eamodio.gitlens
  code --install-extension ehaynes99.vscode-select-same-text
  code --install-extension enkia.tokyo-night
  code --install-extension Equinusocio.vsc-community-material-theme
  code --install-extension Equinusocio.vsc-material-theme
  code --install-extension equinusocio.vsc-material-theme-icons
  code --install-extension esbenp.prettier-vscode
  code --install-extension GitHub.vscode-pull-request-github
  code --install-extension golang.go
  code --install-extension GraphQL.vscode-graphql
  code --install-extension mikestead.dotenv
  code --install-extension ms-azuretools.vscode-docker
  code --install-extension ms-vscode-remote.remote-containers
  code --install-extension ms-vsliveshare.vsliveshare
  code --install-extension ronnidc.nunjucks
  code --install-extension rust-lang.rust
  code --install-extension sleistner.vscode-fileutils
  code --install-extension streetsidesoftware.code-spell-checker
  code --install-extension Themer.theme-themer-vscode
  code --install-extension tomoki1207.pdf
  code --install-extension vscodevim.vim
fi

if [ ! -d $home_dir/.vscode/extensions/theme-themer-vscode ]; then
  echo "Linking VSCode config - theme (via extensions)"
  ln -s $dotfiles_dir/vscode/extensions/theme-themer-vscode $home_dir/.vscode/extensions/theme-themer-vscode
fi

if [ ! -f $home_dir/Library/Application\ Support/Code/User/settings.json ]; then
  echo "Linking VSCode config - settings.json"
  ln -s $dotfiles_dir/vscode/settings.json $home_dir/Library/Application\ Support/Code/User/settings.json
fi

if [ ! -f $home_dir/Library/Application\ Support/Code/User/keybindings.json ]; then
  echo "Linking VSCode config - keybindings.json"
  ln -s $dotfiles_dir/vscode/keybindings.json $home_dir/Library/Application\ Support/Code/User/keybindings.json
fi

if [ ! -d $home_dir/Library/Application\ Support/Code/User/snippets ]; then
  echo "Linking VSCode config - snippets"
  ln -s $dotfiles_dir/vscode/snippets $home_dir/Library/Application\ Support/Code/User/snippets
fi

cd ~
